@using DominosPizza.Models;
@{
    
    ViewBag.Title = "Dominos Пицца - доставка пиццы, суши, бургеров и любой еды в городе Петрозаводске круглосуточно";

}

@model IEnumerable<Product>
<!--<br /><p style="font-size: .9rem; color: gray; line-height: 110%; text-align:center;">
    Инструкция для тестовых испытаний: переключение между публичным и служебным интерфейсами осуществляется через белый квадратный логотип вверху страницы.
</p><br />--> 
    <div class="well content" style="justify-content: center;">
        @foreach (var product in Model) {
    <div class="well pizzacard" style="margin: 2px;">
        <img class="pizzaimg" src="@product.ImageLink"/>
        <div class="pizzaname">
            <span class="pizzaname-text">@product.ProductName</span>
        </div>
        <div class="pizzacontent">
           @product.ProductDescription
        </div>

      <!--  <div class="pizzasize">
            <div class="pizzasize-active" >35см</div>
            <div class="pizzasize-passive">30см</div>
            <div class="pizzasize-passive">25см</div>
        </div>-->
       <!-- <p class="doughselect"><span class="doughselect-active">Традиционное</span><span class="doughselect-passive"> / Тонкое</span></p>-->
        <p class="pizzaweight">@product.ProductWeight г.</p>

        <div class="pizzaorder">
            <div class="pizzaorder-price">@product.ProductPrice <span>&#8381;</span></div>
            <div id="addtocartbtn-@product.ProductId" class="pizzaorder-tocart">в корзину</div>

            <input id="addtocartinp-@product.ProductId" type="hidden" name="productId" value="@product.ProductId" />
            <div id="successFadeOut-@product.ProductId" class="successFadeOut" style="display:none;">добавлено</div>
        </div>

    </div>
        }

    </div>
<button id="commentsShow-">chat</button>
<!--место для загрузки Partial View c комментариями-->
<div id="comments-modal" class="comments-modal">

    <div class="comments-window">

        <div id="comment-PartialView"> </div>

    </div>
    <div class="addNewComment">

        <textarea id="NewCommentInput" placeholder="введите здесь текст сообщения и нажмите на имя пользователя для отправки"></textarea>
        <div class="commentUser">
            <div><button id="chat-Add-message-" class="btn btn-default" title="отправить"><span class="glyphicon glyphicon-user"></span> АннаМенеджер</button></div>
            <button id="closeComments" class="btn btn-danger" onclick="hideComments()">
                <span class="glyphicon glyphicon-remove"></span>
            </button>
        </div>
    </div>
</div>
<!---->
<script src="/Scripts/jquery-1.10.2.js"></script>
<script type="text/javascript">
    var taskId = 0;

    $("button").click(function (event) {

        if (this.id.slice(0, 13) == "commentsShow-") {
            event.preventDefault();
            $("#comments-modal").css({
                "display": "block", "overflow": "hidden", "flex-direction": "column", "display": "flex", "justify-content": "center", "vertical-align": "top"
            });
            // CustomerId = parseInt(this.id.slice(13));
            $.ajax({
                url: "/Messaging/TaskCommentsShow",
                dataType: "html",
                //     data: {
                //         taskId: taskId,
                //     },
                type: "POST",
                success: function (data) {
                    $("#comment-PartialView").html(data);
                }
            });
        }

        //string onlineChatUniqueId, int customerId, int userId, bool messageByUser, string messageText)
        
        if (this.id == "chat-Add-message-") {
            event.preventDefault();
            $("#chat-modal").css({
                "display": "block", "overflow": "hidden", "flex-direction": "column", "display": "flex", "justify-content": "center", "vertical-align": "top"
            });
            //            var taskId = parseInt(this.id.slice(13)); //значение остаётся от функции открытия окна комментов
            var userID = 1; //!!! пока так, но позже пользователя над будет определять по логину
            var newCommentText = $("#NewCommentInput").val();
            alert("here");
            $.ajax({
                url: "/Messaging/AddNewMessageToChat",
                dataType: "json",
                data: {
                    customerId: 2,
                    userId: 1,
                    messageByUser: false,
                    messageText: newCommentText
                },
                type: "POST",
                success: function (data) {
                   // $("#comment-PartialView").html(data);
                    alert(data.Data);
                }
            });
        }
    });



</script>


<!--закрытие окна с комментариями-->
<script>
    function hideComments() {
        $("#comments-modal").css({ "display": "none" });
    }
</script>
<!---->


@*AJAX добавление в корзину*@
<script src="/Scripts/jquery-1.10.2.js"></script>
<script type="text/javascript">
    var c = 0;
    $("div.pizzaorder-tocart").click(function (event) {

        if (this.id.slice(0, 13) == "addtocartbtn-") {
            event.preventDefault();
            var pid = parseInt(this.id.slice(13), 10);
            var temp = "#addtocartinp-" + pid;
            var amount = parseInt($(temp).val());
            var successFadeOut = "#successFadeOut-" + pid;
            $.ajax({
                url: "/Home/AddtoCart",
                dataType: "json",
                data: {
                    productId: amount,
                    amount: 1
                },
                type: "POST",
                success: function (data) {
                    $("#cartindicator").html(data.Data);
                    $(successFadeOut).css("display", "block");
                    $(successFadeOut).fadeOut(1000);
                    }
                
            });
        }
    });
</script>
    